<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spatiotemporal Dracula</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin="" />
    
    <!-- Leaflet Timeline CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-timeline-slider@1.0.1/src/leaflet.timelineSlider.min.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
        }
        
        header {
            background-color: #2d0a0a;
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #8b0000;
        }
        
        h1 {
            color: #c41e3a;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            color: #a0a0a0;
            margin-top: 5px;
        }
        
        #map-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 100px);
        }
        
        #map {
            flex: 1;
            min-height: 400px;
        }
        
        #content-panel {
            background-color: #2a2a2a;
            padding: 20px;
            border-top: 2px solid #8b0000;
            max-height: 200px;
            overflow-y: auto;
        }
        
        #content-panel h3 {
            color: #c41e3a;
            margin-bottom: 10px;
        }
        
        #content-text {
            line-height: 1.6;
            color: #d0d0d0;
        }
        
        .leaflet-popup-content-wrapper {
            background-color: #2d0a0a;
            color: #f0f0f0;
            border: 2px solid #8b0000;
        }
        
        .leaflet-popup-tip {
            background-color: #2d0a0a;
        }
        
        .leaflet-popup-content {
            margin: 15px;
        }
        
        .popup-title {
            font-weight: bold;
            color: #c41e3a;
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        .popup-date {
            color: #a0a0a0;
            font-style: italic;
            margin-bottom: 10px;
        }
        
        .popup-content {
            color: #d0d0d0;
            line-height: 1.5;
        }
        
        /* Timeline slider styling */
        .time-slider-container {
            background-color: #2a2a2a;
            padding: 15px 20px;
            border-top: 2px solid #8b0000;
        }
        
        .time-slider-label {
            color: #c41e3a;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }
        
        #time-slider {
            width: 100%;
            cursor: pointer;
        }
        
        .time-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        .time-controls button {
            background-color: #8b0000;
            color: white;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 4px;
            font-family: inherit;
        }
        
        .time-controls button:hover {
            background-color: #c41e3a;
        }
        
        .time-controls button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        
        #current-date {
            color: #f0f0f0;
            font-size: 1.1em;
        }
        
        .instructions {
            background-color: #333;
            padding: 10px 20px;
            color: #a0a0a0;
            font-size: 0.9em;
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <h1>ü¶á Spatiotemporal Dracula ü¶á</h1>
        <p class="subtitle">Journey through the locations and events of Bram Stoker's Dracula</p>
    </header>
    
    <div class="instructions">
        Use the timeline slider below the map to step through events. Click on markers for more details.
    </div>
    
    <div id="map-container">
        <div id="map"></div>
        
        <div class="time-slider-container">
            <label class="time-slider-label">Timeline Navigation</label>
            <input type="range" id="time-slider" min="0" max="100" value="0" />
            <div class="time-controls">
                <button id="prev-btn">‚Üê Previous</button>
                <button id="play-btn">‚ñ∂ Play</button>
                <button id="next-btn">Next ‚Üí</button>
                <span id="current-date">Select an event</span>
            </div>
        </div>
        
        <div id="content-panel">
            <h3>üìú Event Details</h3>
            <p id="content-text">Use the timeline slider or click on a marker to view event content.</p>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <script>
        // GeoJSON data with time-based features and content
        const draculaData = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Jonathan Harker's Journey Begins",
                        "date": "1893-05-03",
                        "time": 1,
                        "content": "Jonathan Harker, a young English solicitor, departs from Munich on his journey to Transylvania. He is traveling to meet Count Dracula at his castle to assist with the purchase of property in England. His journal begins with notes about the strange customs and superstitions of the local people."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [11.5820, 48.1351]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Arrival in Bistritz",
                        "date": "1893-05-03",
                        "time": 2,
                        "content": "Harker arrives in Bistritz and stays at the Golden Krone Hotel. The landlady becomes distressed upon learning of his destination and gives him a crucifix for protection. Fellow travelers make the sign of the cross and point two fingers at him as a charm against the evil eye."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [24.5000, 47.1333]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "The Borgo Pass",
                        "date": "1893-05-04",
                        "time": 3,
                        "content": "At the Borgo Pass, Harker is met by a mysterious driver sent by Count Dracula. The coach is pulled by coal-black horses, and the driver has remarkable strength. Wolves howl in the distance as they travel through the Carpathian Mountains toward the castle."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [25.3500, 47.2500]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Castle Dracula",
                        "date": "1893-05-05",
                        "time": 4,
                        "content": "Jonathan Harker arrives at Castle Dracula, a vast ruined castle perched on the edge of a precipice. Count Dracula welcomes him with old-world courtesy: 'Welcome to my house! Enter freely and of your own will!' The Count is tall, dressed entirely in black, with peculiar sharp white teeth and hairy palms."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [25.3717, 47.3531]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Prisoner in the Castle",
                        "date": "1893-05-12",
                        "time": 5,
                        "content": "Harker realizes he is a prisoner. All doors are locked, and there are no servants. The Count discusses English real estate and practices English pronunciation. Harker notices the Count casts no reflection in his shaving mirror. He discovers he cannot escape ‚Äì every window overlooks a sheer precipice."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [25.3717, 47.3531]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "The Demeter Sets Sail",
                        "date": "1893-07-06",
                        "time": 6,
                        "content": "The Russian schooner Demeter departs Varna, carrying fifty boxes of earth destined for Carfax Abbey in England. Among the cargo is Count Dracula himself, hidden in one of the boxes. The crew is unaware of the horror that accompanies them on their voyage."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [27.9147, 43.2141]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "The Demeter Wrecks at Whitby",
                        "date": "1893-08-08",
                        "time": 7,
                        "content": "A violent storm drives the Demeter ashore at Whitby. The ship crashes into the harbor, its dead captain lashed to the helm. A large dog leaps from the deck and runs up the cliff toward the church ‚Äì it is Dracula in wolf form. The ship's log tells of crew members vanishing one by one during the voyage."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-0.6206, 54.4862]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Lucy's Sleepwalking",
                        "date": "1893-08-11",
                        "time": 8,
                        "content": "Lucy Westenra begins sleepwalking in Whitby, where she is staying with her friend Mina Murray. Mina finds Lucy in the churchyard at night, with a dark figure bending over her. Lucy's health begins to decline mysteriously, with two small puncture marks appearing on her throat."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-0.6132, 54.4871]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Van Helsing Arrives in London",
                        "date": "1893-09-02",
                        "time": 9,
                        "content": "Dr. Abraham Van Helsing, a professor from Amsterdam and expert in obscure diseases, arrives in London at the request of Dr. Seward. He examines Lucy and recognizes the marks on her throat. He orders garlic flowers placed around her room and a crucifix around her neck, though he does not yet reveal his suspicions."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-0.1276, 51.5074]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Death and Undeath of Lucy",
                        "date": "1893-09-20",
                        "time": 10,
                        "content": "Despite blood transfusions from her suitors, Lucy dies ‚Äì only to return as a vampire. Reports surface of a 'beautiful lady' luring children on Hampstead Heath. Van Helsing leads Arthur Holmwood, Dr. Seward, and Quincey Morris to Lucy's tomb, where they witness her undead state. Arthur drives a stake through her heart, granting her true death."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-0.1636, 51.5615]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Carfax Abbey Investigation",
                        "date": "1893-10-01",
                        "time": 11,
                        "content": "The vampire hunters investigate Carfax Abbey, the property Dracula purchased through Jonathan Harker. They discover it filled with earth-boxes from Transylvania and swarms of rats. Van Helsing explains that Dracula must rest in his native soil. They begin the task of sterilizing the boxes with sacred wafers."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-0.0506, 51.5029]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Mina's Contamination",
                        "date": "1893-10-03",
                        "time": 12,
                        "content": "While the men hunt for Dracula's earth-boxes, the Count attacks Mina Harker at the asylum. He forces her to drink his blood, creating a psychic link between them. A scar from a sacred wafer appears on her forehead. Van Helsing realizes they can use this connection to track Dracula."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-0.0762, 51.5085]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Dracula Flees England",
                        "date": "1893-10-04",
                        "time": 13,
                        "content": "With most of his earth-boxes destroyed, Dracula flees London aboard the ship Czarina Catherine, bound for Varna. The hunters realize he is returning to Transylvania to escape them. They prepare to pursue him, knowing they must destroy him before the curse on Mina becomes permanent."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-0.0553, 51.5045]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "The Chase Through Europe",
                        "date": "1893-10-15",
                        "time": 14,
                        "content": "The vampire hunters travel across Europe in pursuit of Dracula. They take trains through France and Eastern Europe, racing against time. Van Helsing uses hypnosis on Mina to track Dracula's movements through their psychic link. The Count's ship is spotted heading up the Danube."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [26.1025, 44.4268]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Final Confrontation",
                        "date": "1893-11-06",
                        "time": 15,
                        "content": "The hunters intercept Dracula's coffin as it is being transported to Castle Dracula by gypsies. As the sun sets, Jonathan Harker slashes Dracula's throat with a kukri knife while Quincey Morris plunges a bowie knife into his heart. The Count crumbles to dust before their eyes. Morris dies from wounds received in the fight, and Mina's curse is lifted."
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [25.3717, 47.3531]
                    }
                }
            ]
        };

        // Initialize the map centered on Europe
        const map = L.map('map').setView([48.0, 15.0], 4);

        // Add dark-themed tile layer
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // Custom marker icon
        const draculaIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background-color: #8b0000; width: 12px; height: 12px; border-radius: 50%; border: 2px solid #c41e3a; box-shadow: 0 0 10px rgba(139, 0, 0, 0.8);"></div>',
            iconSize: [16, 16],
            iconAnchor: [8, 8]
        });

        const activeIcon = L.divIcon({
            className: 'custom-marker-active',
            html: '<div style="background-color: #c41e3a; width: 18px; height: 18px; border-radius: 50%; border: 3px solid #ff6b6b; box-shadow: 0 0 20px rgba(196, 30, 58, 1);"></div>',
            iconSize: [24, 24],
            iconAnchor: [12, 12]
        });

        // Store markers and features
        const markers = [];
        const features = draculaData.features.sort((a, b) => a.properties.time - b.properties.time);
        let currentIndex = 0;
        let isPlaying = false;
        let playInterval = null;

        // Create markers for all features
        features.forEach((feature, index) => {
            const coords = feature.geometry.coordinates;
            const props = feature.properties;
            
            const marker = L.marker([coords[1], coords[0]], { icon: draculaIcon }).addTo(map);
            
            const popupContent = `
                <div class="popup-title">${props.title}</div>
                <div class="popup-date">${props.date}</div>
                <div class="popup-content">${props.content}</div>
            `;
            
            marker.bindPopup(popupContent, { maxWidth: 300 });
            
            marker.on('click', () => {
                currentIndex = index;
                updateTimelineUI();
                displayContent(feature);
            });
            
            markers.push(marker);
        });

        // Set up the timeline slider
        const slider = document.getElementById('time-slider');
        slider.max = features.length - 1;
        
        slider.addEventListener('input', (e) => {
            currentIndex = parseInt(e.target.value);
            updateTimelineUI();
            displayContent(features[currentIndex]);
        });

        // Navigation buttons
        document.getElementById('prev-btn').addEventListener('click', () => {
            if (currentIndex > 0) {
                currentIndex--;
                updateTimelineUI();
                displayContent(features[currentIndex]);
            }
        });

        document.getElementById('next-btn').addEventListener('click', () => {
            if (currentIndex < features.length - 1) {
                currentIndex++;
                updateTimelineUI();
                displayContent(features[currentIndex]);
            }
        });

        document.getElementById('play-btn').addEventListener('click', () => {
            if (isPlaying) {
                stopPlayback();
            } else {
                startPlayback();
            }
        });

        function startPlayback() {
            isPlaying = true;
            document.getElementById('play-btn').textContent = '‚è∏ Pause';
            playInterval = setInterval(() => {
                if (currentIndex < features.length - 1) {
                    currentIndex++;
                    updateTimelineUI();
                    displayContent(features[currentIndex]);
                } else {
                    stopPlayback();
                }
            }, 3000);
        }

        function stopPlayback() {
            isPlaying = false;
            document.getElementById('play-btn').textContent = '‚ñ∂ Play';
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
        }

        function updateTimelineUI() {
            slider.value = currentIndex;
            
            // Update button states
            document.getElementById('prev-btn').disabled = currentIndex === 0;
            document.getElementById('next-btn').disabled = currentIndex === features.length - 1;
            
            // Update marker icons
            markers.forEach((marker, index) => {
                if (index === currentIndex) {
                    marker.setIcon(activeIcon);
                } else {
                    marker.setIcon(draculaIcon);
                }
            });
            
            // Pan to current marker
            const coords = features[currentIndex].geometry.coordinates;
            map.flyTo([coords[1], coords[0]], 6, { duration: 1 });
        }

        function displayContent(feature) {
            const props = feature.properties;
            document.getElementById('current-date').textContent = `${props.date} - ${props.title}`;
            document.getElementById('content-text').textContent = props.content;
            
            // Open popup on the marker
            markers[currentIndex].openPopup();
        }

        // Initialize with first feature
        setTimeout(() => {
            updateTimelineUI();
            displayContent(features[0]);
        }, 500);
    </script>
</body>
</html>
